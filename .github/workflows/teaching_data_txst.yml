# This file was generated using Kotlin DSL (.github/workflows/teaching.main.kts).
# If you want to modify the workflow, please change the Kotlin file and regenerate this YAML file.
# Generated with https://github.com/typesafegithub/github-workflows-kt

name: 'TXST: Update Teaching Data'
on:
  workflow_dispatch: { }
  schedule:
    - cron: '0 22 * * 1-5'
jobs:
  get_and_commit:
    runs-on: 'ubuntu-latest'
    steps:
      - id: 'step-0'
        name: 'Checkout code'
        uses: 'actions/checkout@v4'
      - id: 'step-1'
        name: 'Checkout data'
        uses: 'actions/checkout@v4'
        with:
          repository: 'opletter/course-evals-data'
          token: '${{ secrets.EVALS_DATA_TOKEN }}'
          path: 'data'
      - id: 'step-2'
        name: 'Set up Java'
        uses: 'actions/setup-java@v3'
        with:
          java-version: '17'
          distribution: 'temurin'
      - id: 'step-3'
        name: 'Run'
        run: './gradlew colleges:txst:run --args="-teaching ../../data/txst/processed/stats-by-prof ../../data/txst/processed/core/teaching-S24"'
      - id: 'step-4'
        name: 'Add & Commit'
        run: |-
          cd data
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add -A
          if ! git diff --cached --quiet; then
              git commit -m "TXST: Updated teaching data"
              git pull --rebase origin master
              git push
          else
              echo "No changes. Nothing to commit."
          fi